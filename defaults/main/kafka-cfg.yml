---

kafka_cluster_uuid: "{{ 'kafka_role' | to_uuid | uuid_to_base64(short=true) }}"

kafka_cfg: "{{ [kafka_cfg_default, kafka_cfg_base | default([]), kafka_cfg_extra | default([])] | community.general.lists_mergeby('section', recursive=true) }}"

kafka_cfg_default:
  - section: 'brokers'
    properties:
      process.roles: "{{ kafka_process_roles | default('broker,controller') }}"
      node.id: "{{ kafka_node_id }}"
      controller.quorum.voters: "{{ kafka_controller_quorum_voters }}"
      listeners: "{{ kafka_listeners }}"
      inter.broker.listener.name: "{{ kafka_inter_broker_listener_name }}"
      advertised.listeners: "{{ kafka_advertised_listeners }}"
      controller.listener.names: "{{ kafka_controller_listener_names }}"
      listener.security.protocol.map: "{{ kafka_security_protocol_map }}"
      log.dirs: "{{ kafka_data_path }}"
      controller.quorum.bootstrap.servers: "{{ kafka_controller_quorum_bootstrap_servers }}"

broker_cfg: "{{ [broker_cfg_default, broker_cfg_base | default([]), broker_cfg_extra | default([])] | community.general.lists_mergeby('section', recursive=true) }}"

controller_cfg: "{{ [controller_cfg_default, controller_cfg_base | default([]), controller_cfg_extra | default([])] | community.general.lists_mergeby('section', recursive=true) }}"

kafka_controller_bootstrap_command: "{{ kafka_install_path }}/bin/kafka-storage.sh format --cluster-id {{ kafka_cluster_uuid }} --initial-controllers {{ kafka_initial_controllers }} -c {{ kafka_conf_path }}/server.properties --ignore-formatted"
